"use strict";(self.webpackChunk_yoskutik_mobx_form_schema_docs=self.webpackChunk_yoskutik_mobx_form_schema_docs||[]).push([[218],{2218:function(e,t,r){r.r(t),r.d(t,{default:function(){return y}});var n=r(8993),a=r(1568),o=r(7974),i={filename:"BasicExample.tsx",code:"import { observer } from 'mobx-react';\r\nimport { useMemo } from 'react';\r\nimport { TextField } from '@components';\r\nimport { SchemaObservationInfo } from '../SchemaObservationInfo';\r\nimport { ObservationButtons } from '../ObservationButtons';\r\nimport { BasicSchema } from './BasicSchema';\r\n\r\nexport const BasicExample = observer(() => {\r\n  const schema = useMemo(() => BasicSchema.create(), []);\r\n\r\n  const handleSaveClick = () => {\r\n    schema.sync();\r\n  };\r\n\r\n  const handleRestoreClick = () => {\r\n    schema.reset();\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <TextField schema={schema} field=\"name\" label=\"Name\" />\r\n      <TextField schema={schema} field=\"surname\" label=\"Surname\" />\r\n\r\n      <ObservationButtons\r\n        onRestore={handleRestoreClick}\r\n        onSave={handleSaveClick}\r\n        schema={schema}\r\n      />\r\n\r\n      <SchemaObservationInfo schema={schema} />\r\n    </div>\r\n  );\r\n});\r\n"},s={filename:"BasicSchema.ts",code:"import { FormSchema, watch } from '@yoskutik/mobx-form-schema';\r\n\r\nexport class BasicSchema extends FormSchema {\r\n  @watch name = 'Joe';\r\n\r\n  @watch surname = 'Dough';\r\n}\r\n"},c={filename:"SameSchema1.ts",code:"import { FormSchema, watch } from '@yoskutik/mobx-form-schema';\r\nimport { makeObservable, observable } from 'mobx';\r\n\r\nexport class SameSchema1 extends FormSchema {\r\n  @watch @observable data = {\r\n    prop1: 1,\r\n    prop2: 2,\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    makeObservable(this);\r\n  }\r\n}\r\n"},l={filename:"SameSchema2.ts",code:"import { FormSchema, watch } from '@yoskutik/mobx-form-schema';\r\nimport { makeObservable, observable } from 'mobx';\r\n\r\nexport class SameSchema1 extends FormSchema {\r\n  @watch data = {\r\n    prop1: 1,\r\n    prop2: 2,\r\n  };\r\n\r\n  constructor() {\r\n    super();\r\n    makeObservable(this, {\r\n      data: observable,\r\n    });\r\n  }\r\n}\r\n"},h=r(4309),d=r(8379),m=r(4133),u=r(858),f=r(4831);let p=(0,h.Pi)(()=>{let e=(0,d.useMemo)(()=>f.d.create(),[]),t=()=>{e.sync()},r=()=>{e.reset()};return(0,n.BX)("div",{children:[(0,n.tZ)(a.nv,{schema:e,field:"name",label:"Name"}),(0,n.tZ)(a.nv,{schema:e,field:"surname",label:"Surname"}),(0,n.tZ)(u.A,{onRestore:r,onSave:t,schema:e}),(0,n.tZ)(m.E,{schema:e})]})}),v=()=>(0,n.BX)(n.HY,{children:[(0,n.BX)(a.$0,{title:"Form changes observation",children:[(0,n.tZ)(a.xv,{children:"Form observation can be very useful. The most basic example is understanding whether your current state of the form is different from the initial one, in case you don't want to send an API request and want to disable the submit button."}),(0,n.BX)(a.$0,{title:"The power of observation",children:[(0,n.tZ)(a.xv,{children:"Here's a full list of features that MobX Form Schema provides:"}),(0,n.BX)(a.aV,{children:[(0,n.tZ)("li",{children:"You can understand whether the form is different from the initial state;"}),(0,n.tZ)("li",{children:"You can retrieve a list of properties' names that are different from the initial state;"}),(0,n.tZ)("li",{children:"You can retrieve the property's value from the initial state;"}),(0,n.tZ)("li",{children:"You can restore the whole schema into the initial state;"}),(0,n.tZ)("li",{children:"And also, you can save the current state as the initial one."})]}),(0,n.BX)(a.xv,{children:["To enable form data observation, you have to apply ",(0,n.tZ)(a.EK,{children:"@watch"})," decorators to the properties you want to observe."]}),(0,n.BX)(a.bZ,{children:[(0,n.tZ)(a.EK,{children:"@watch"})," decorator works well if you observe primitive values, like stings, numbers or boolean values. In case you want to observe complex objects, you have to use ",(0,n.tZ)(a.EK,{children:"watch"})," modifiers, which will be described in the next article."]}),(0,n.BX)(a.xv,{children:["In the short example below, you can see the most basic observation functionality. You try clicking ",(0,n.tZ)("i",{children:'"Save"'})," and ",(0,n.tZ)("i",{children:'"Restore"'})," buttons for better understanding how does it work."]}),(0,n.tZ)(a.KE,{items:[s,i,o.Z],children:(0,n.tZ)(p,{})})]}),(0,n.tZ)(a.$0,{title:"How does it check changes?",children:(0,n.BX)(a.xv,{children:["Form schema saves the initial state, and after each change in a property, checks whether the new property's value different from the one in the initial state. If you use plain ",(0,n.tZ)(a.EK,{children:"@watch"})," decorator, there will be reference comparison (via ",(0,n.tZ)(a.EK,{children:"==="})," operator)."]})}),(0,n.BX)(a.$0,{title:"How does watch decorator make property observable?",children:[(0,n.BX)(a.xv,{children:["By default, if you apply ",(0,n.tZ)(a.EK,{children:"@watch"})," decorator to a property, it will automatically apply ",(0,n.tZ)(a.EK,{children:"@observable.ref"})," decorator from MobX. Therefore, in most cases if you use",(0,n.tZ)(a.EK,{children:"@watch"})," decorator, you don't have to use decorators from MobX."]}),(0,n.BX)(a.xv,{children:["But you can freely do it. If, for some reason, you have to compare different objects via their reference, but these objects have to be decorated with ",(0,n.tZ)(a.EK,{children:"@observable"}),", you can do it."]}),(0,n.tZ)(a.KE,{items:[c,l]})]}),(0,n.BX)(a.$0,{title:"Should you use watch decorator?",children:[(0,n.tZ)(a.xv,{children:"As you may have guessed when using it, MobX Form Schema has to save the initial data of the form, which means that memory consumption will grow. And also, each time the observed property changes, there will be a recalculation to understand whether the current property's value is different from the initial one."}),(0,n.BX)(a.xv,{children:["But in general, those additional computational loads and memory consumption are low because of MobX's and MobX Form Schema's optimizations. So, you shouldn't worry about using ",(0,n.tZ)(a.EK,{children:"@watch"})," decorators, especially if you have a need to observe form data."]})]})]}),(0,n.tZ)(a.$0,{title:"Next",forcedLevel:3,children:(0,n.tZ)(a.xv,{children:"In this section you saw how to observe primitive data. In the next article you'll find out how to configure your form schema in order to use arrays, sets or nested schemas."})})]});var y=v},4831:function(e,t,r){let n,a,o,i,s,c;r.d(t,{d:function(){return u}});var l,h=r(8520),d=function(e,t,r,n,a,o){function i(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var s,c=n.kind,l="getter"===c?"get":"setter"===c?"set":"value",h=!t&&e?n.static?e:e.prototype:null,d=t||(h?Object.getOwnPropertyDescriptor(h,n.name):{}),m=!1,u=r.length-1;u>=0;u--){var f={};for(var p in n)f[p]="access"===p?{}:n[p];for(var p in n.access)f.access[p]=n.access[p];f.addInitializer=function(e){if(m)throw TypeError("Cannot add initializers after decoration has completed");o.push(i(e||null))};var v=(0,r[u])("accessor"===c?{get:d.get,set:d.set}:d[l],f);if("accessor"===c){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw TypeError("Object expected");(s=i(v.get))&&(d.get=s),(s=i(v.set))&&(d.set=s),(s=i(v.init))&&a.unshift(s)}else(s=i(v))&&("field"===c?a.unshift(s):d[l]=s)}h&&Object.defineProperty(h,n.name,d),m=!0},m=function(e,t,r){for(var n=arguments.length>2,a=0;a<t.length;a++)r=n?t[a].call(e,r):t[a].call(e);return n?r:void 0};let u=(o=h.FormSchema,i=[],s=[],c=[],l=class extends o{constructor(){super(...arguments),this.name=(m(this,i),m(this,s,"Joe")),this.surname=m(this,c,"Dough")}},(()=>{var e;let t="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(e=o[Symbol.metadata])&&void 0!==e?e:null):void 0;n=[h.watch],a=[h.watch],d(null,null,n,{kind:"field",name:"name",static:!1,private:!1,access:{has:e=>"name"in e,get:e=>e.name,set:(e,t)=>{e.name=t}},metadata:t},s,i),d(null,null,a,{kind:"field",name:"surname",static:!1,private:!1,access:{has:e=>"surname"in e,get:e=>e.surname,set:(e,t)=>{e.surname=t}},metadata:t},c,i),t&&Object.defineProperty(l,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:t})})(),l)},858:function(e,t,r){r.d(t,{A:function(){return i}});var n=r(8993),a=r(4309),o=r(1568);let i=(0,a.Pi)(({schema:e,onRestore:t,onSave:r})=>(0,n.BX)("div",{style:{marginTop:12},children:[(0,n.tZ)(o.zx,{variant:"primary",onClick:r,disabled:!e.isChanged,children:"Save"}),(0,n.tZ)(o.zx,{onClick:t,disabled:!e.isChanged,style:{marginLeft:12},variant:"primary",children:"Restore"})]}))},4133:function(e,t,r){r.d(t,{E:function(){return s}});var n=r(8993),a=r(4309),o=r(75),i={root:"HQPJ",pre:"gwvf",preItem:"FVu9"};let s=(0,a.Pi)(({schema:e})=>{let t=e=>{let t=(0,o.ZN)(e);return JSON.stringify(t instanceof Set?[...t]:t,void 0,2)};return(0,n.BX)("div",{className:i.root,children:[(0,n.BX)("span",{children:["Is form changed: ",e.isChanged.toString()]}),(0,n.BX)("div",{className:i.pre,children:["Changed properties: ",t(e.changedProperties)]}),(0,n.BX)("div",{className:i.pre,children:["Initial properties properties:",Object.keys(e).map(r=>(0,n.BX)("div",{className:i.preItem,children:[r,": ",t(e.getInitial(r))]},r))]})]})})},7974:function(e,t){t.Z={filename:"SchemaObservationInfo.tsx",code:"import { FormSchema } from '@yoskutik/mobx-form-schema';\r\nimport { observer } from 'mobx-react';\r\nimport { toJS } from 'mobx';\r\nimport styles from './SchemaObservationInfo.module.scss';\r\n\r\ntype Props<T extends FormSchema> = {\r\n  schema: T;\r\n};\r\n\r\nexport const SchemaObservationInfo = observer(<T extends FormSchema>({ schema }: Props<T>) => {\r\n  const stringify = (data: unknown) => {\r\n    const jsData = toJS(data);\r\n    return JSON.stringify(jsData instanceof Set ? [...jsData] : jsData, undefined, 2);\r\n  };\r\n\r\n  return (\r\n    <div className={styles.root}>\r\n      <span>Is form changed: {schema.isChanged.toString()}</span>\r\n\r\n      <div className={styles.pre}>\r\n        Changed properties: {stringify(schema.changedProperties)}\r\n      </div>\r\n\r\n      <div className={styles.pre}>\r\n        Initial properties properties:\r\n        {Object.keys(schema).map(property => (\r\n          <div className={styles.preItem} key={property}>\r\n            {property}: {stringify(schema.getInitial(property as any))}\r\n          </div>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n});\r\n"}},4593:function(e,t,r){r.d(t,{FormSchema:function(){return D},factory:function(){return G},nestedSchema:function(){return ei},nestedSchemasArray:function(){return es},present:function(){return er},validate:function(){return C},watch:function(){return W}});var n,a,o,i=r(75);let s=e=>Symbol(e),c=s(),l=s(),h=s("InitialValues"),d=s("Errors"),m=s("ChangedKeys"),u=s(),f=s(),p=s(),v=s(),y=Object,b="comparator",g="presentation",w="schema",S="schemasArray",x=y.keys,k=new WeakMap,I=(e,t="string")=>typeof e===t,Z=e=>k.get(e),B=(e,t,r)=>(r=(r=Z(t))&&r[e])?r:(r=I(r=y.getPrototypeOf(t),"object")?r:null)?B(e,r):void 0,O=(e,t)=>B(e,t)||{},F=(e,t,r,n,a,o)=>{t&&(I(r)||I(r,"symbol"))?((a=O(e,t))[p]!==t&&(a=y.assign({},a)),a[r]=n,a[p]=t,(Z(t)||k.set(t,{})&&Z(t))[e]=a):r.addInitializer(function(){F(e,this,r.name,n)})},C=(...e)=>(t,r)=>F(l,t,r,{validators:e});C.if=(e,t)=>(r,n)=>F(l,r,n,{validators:t,condition:e});let E=(e,t,r)=>q(x(e).concat(x(t))).forEach(e=>r(e)),X=(e,t,r)=>!!(t[r]&&(!t[r].condition||t[r].condition(e[r],e))),P=(e,t,r,n=X(e,t,r),a)=>!!t[r]&&(n&&t[r].validators.find(t=>a=t(e[r],e)),(0,i.z)(()=>I(a)||!0===a?e[d][r]=a:delete e[d][r]),a),j=(e,t,r,n)=>(n=!t[r]||t[r][b](e[r],e[h][r],e,r),(0,i.z)(()=>e[m][n?"delete":"add"](r)),!n),A=(e,t,r,n)=>x(n=O(t,e)).reduce((t,a)=>!!r(e,n,a)||t,!1),N=(e,t,r,n)=>x(n=O(c,e)).forEach(a=>r(e,a,n[a][t])),T=e=>{e[v]&&(e.updateIsValidAll(),e.updateIsChangedAny())},z=(e,t)=>x(e).forEach(e=>t(e));class D{static create(e={},t){let r=new this(e),n=O(u,r),a=O(l,r),o=O(c,r),s={[h]:i.LO.ref,[m]:i.LO,[d]:i.LO,[g]:i.Fl,isChanged:i.Fl,isValid:i.Fl,errors:i.Fl,updateIsPropertyChanged:i.aD,updateIsPropertyValid:i.aD,updateIsChangedAny:i.aD,updateIsValidAll:i.aD,reset:i.aD,sync:i.aD};E(n,e,t=>{n[t]?r[t]=n[t](e[t],e,r,r[t]):t in e&&(r[t]=e[t])}),z(o,(e,t,n)=>{(0,i.wn)(r,e)||(t=i.LO,(n=o[e][b])===M||n===L?t=i.LO.ref:(n===Y||n===R||n===J)&&(t=i.LO.shallow),s[e]=t)});try{(0,i.rC)(r,s)}catch(e){z(s,e=>!(0,i.wn)(r,e)&&s[e](r,e)),(0,i.rC)(r)}return r.sync(),r[v]=t,t||(z(o,(e,t)=>(0,i.N7)(r,e,()=>(t&&t(),t=(0,i.EH)(()=>j(r,o,e))),!0)),z(a,(e,t)=>{t=i.LO.box(!1),(0,i.EH)(n=>(n=X(r,a,e),(0,i.z)(()=>t.set(n)))),(0,i.EH)(()=>P(r,a,e,t.get()))})),r.onInit&&r.onInit(),r}get presentation(){let e={},t=this,r=O(f,t);return E(r,t,(n,a)=>{(a=r[n])&&a.hidden||(e[n]=a&&a[g]?a[g](t[n],t):t[n])}),e}get isChanged(){return this[m].size>0}get isValid(){return y.values(this[d]).every(e=>!e)}get errors(){return this[d]}get changedProperties(){return this[m]}getInitial(e){return this[h][e]}sync(){let e={};N(this,"saveFn",(t,r,n)=>e[r]=n(t[r],t)),this[h]=e,T(this)}reset(){N(this,"restoreFn",(e,t,r)=>e[t]=r(e[h][t],e)),T(this)}updateIsPropertyValid(e){return P(this,O(l,this),e)}updateIsValidAll(){return A(this,l,P)}updateIsPropertyChanged(e){return j(this,O(c,this),e)}updateIsChangedAny(){return A(this,c,j)}constructor(){this[n]={},this[a]=q(),this[o]={}}}n=d,a=m,o=h;let K=e=>(e&&e.sync(),e),V=e=>(e&&e.reset(),e),M=(e,t,r,n,a,o)=>(!e||!e.isChanged)&&(e===t||!!e&&!!t&&e.constructor===t.constructor&&((o=x(a=O(c,e)).find(r=>!a[r][b](e[r],t[r],e)))&&(0,i.z)(()=>e[h]=t[h]),!o)),_=e=>(t,r,n,a)=>!!(r&&t?r.length===t.length&&t.every((t,o)=>e(t,r[o],n,a)):r===t),L=(e,t)=>e===t,H=e=>e,J=_(M),R=(e,t,r,n)=>!!(e&&t&&e.size===t.size&&Array.from(e).every(e=>t.has(e))),Y=_(L),$=e=>e.slice(),q=e=>new Set(e),Q=(e,t,r)=>{let n=(n,a)=>F(c,n,a,{[b]:e,saveFn:t,restoreFn:r});return n[b]=e,n},W=Q(L,H,H);W.create=Q,W[w]=Q(M,K,V),W[S]=Q(J,e=>e?e.map(K):e,e=>e?e.map(V):e),W.array=Q(Y,$,$),W.set=Q(R,q,q);let G=e=>(t,r)=>F(u,t,r,e),U=(e,t)=>t?e.create(t):t,ee=e=>(t,r)=>G((n,a,o,i)=>(t&&I(r)?r:r.name)in a?e(n,a,o,i):i)(t,r);G[w]=e=>ee(t=>U(e,t)),G[S]=e=>ee(t=>t?t.map(t=>U(e,t)):t),G.set=ee(q);let et=e=>(t,r)=>F(f,t,r,e),er=e=>et({[g]:e});er.hidden=et({hidden:!0});let en=(e,t,r,n,a,o)=>(C(r)(e,t),n(e,t),a(e,t),er(o)(e,t)),ea=e=>!e.isValid,eo=e=>e[g],ei=e=>(t,r)=>en(t,r,ea,W[w],G[w](e),eo),es=e=>(t,r)=>en(t,r,e=>e.some(ea),W[S],G[S](e),e=>e.map(eo))},8520:function(e,t,r){e.exports=r(4593)}}]);