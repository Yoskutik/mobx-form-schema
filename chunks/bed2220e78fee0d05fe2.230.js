"use strict";(self.webpackChunk_yoskutik_mobx_form_schema_docs=self.webpackChunk_yoskutik_mobx_form_schema_docs||[]).push([[230],{8994:function(e,t){t.Z={page:"zXdh",link:"gQ1t"}},2230:function(e,t,r){let n,a,s,i,o,c,l,m,d;r.r(t),r.d(t,{default:function(){return A}});var h,u,p=r(8993),f=r(1568),v={filename:"BasicSchema.ts",code:"import { FormSchema, present } from '@yoskutik/mobx-form-schema';\r\nimport { makeObservable, observable } from 'mobx';\r\n\r\nconst presentUsername = (username: string) => (!username ? username : `@${username}`);\r\n\r\nconst presentTitle = (_: unknown, schema: BasicSchema) => {\r\n  if (!schema.username && !schema.name) return 'The unknown';\r\n  if (!schema.username && schema.name) return `The boring ${schema.name}`;\r\n  if (schema.username && !schema.name) return `The sneaky @${schema.username}`;\r\n  return `${schema.name} the @${schema.username}`;\r\n};\r\n\r\nexport class BasicSchema extends FormSchema {\r\n  @present(presentUsername)\r\n  username = '';\r\n\r\n  name = '';\r\n\r\n  @present(presentTitle)\r\n  title = '';\r\n\r\n  constructor() {\r\n    super();\r\n    makeObservable(this, {\r\n      username: observable.ref,\r\n      name: observable.ref,\r\n    });\r\n  }\r\n}\r\n"},b={filename:"BasicExample.tsx",code:'import { observer } from \'mobx-react\';\r\nimport { useMemo } from \'react\';\r\nimport { TextField } from \'@components\';\r\nimport { BasicSchema } from \'./BasicSchema\';\r\n\r\nconst Info = observer(({ data, title }: { data: unknown, title: string }) => (\r\n  <div style={{ marginTop: 12 }}>\r\n    <b>{title}</b>\r\n    <div style={{ marginTop: 4, whiteSpace: \'pre\' }}>\r\n      {JSON.stringify(data, undefined, 2)}\r\n    </div>\r\n  </div>\r\n));\r\n\r\nexport const BasicExample = observer(() => {\r\n  const schema = useMemo(() => BasicSchema.create(), []);\r\n\r\n  return (\r\n    <div>\r\n      <TextField schema={schema} field="name" label="Name" />\r\n      <TextField schema={schema} field="username" label="Username" />\r\n      <Info title="Real values" data={schema} />\r\n      <Info title="Presentation" data={schema.presentation} />\r\n    </div>\r\n  );\r\n});\r\n'},y={filename:"HiddenSchema.ts",code:"import { FormSchema, present } from '@yoskutik/mobx-form-schema';\r\nimport { makeObservable, observable } from 'mobx';\r\n\r\nexport class HiddenSchema extends FormSchema {\r\n  @present.hidden\r\n  username = '';\r\n\r\n  name = '';\r\n\r\n  constructor() {\r\n    super();\r\n    makeObservable(this, {\r\n      username: observable.ref,\r\n      name: observable.ref,\r\n    });\r\n  }\r\n}\r\n"},g={filename:"HiddenExample.tsx",code:'import { observer } from \'mobx-react\';\r\nimport { useMemo } from \'react\';\r\nimport { TextField } from \'@components\';\r\nimport { HiddenSchema } from \'./HiddenSchema\';\r\n\r\nconst Info = observer(({ data, title }: { data: unknown, title: string }) => (\r\n  <div style={{ marginTop: 12 }}>\r\n    <b>{title}</b>\r\n    <div style={{ marginTop: 4, whiteSpace: \'pre\' }}>\r\n      {JSON.stringify(data, undefined, 2)}\r\n    </div>\r\n  </div>\r\n));\r\n\r\nexport const HiddenExample = observer(() => {\r\n  const schema = useMemo(() => HiddenSchema.create(), []);\r\n\r\n  return (\r\n    <div>\r\n      <TextField schema={schema} field="name" label="Name" />\r\n      <TextField schema={schema} field="username" label="Username" />\r\n      <Info title="Real values" data={schema} />\r\n      <Info title="Presentation" data={schema.presentation} />\r\n    </div>\r\n  );\r\n});\r\n'},x=r(8994),S=r(4309),k=r(8379),w=r(8520),O=r(75),T=function(e,t,r,n,a,s){function i(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var o,c=n.kind,l="getter"===c?"get":"setter"===c?"set":"value",m=!t&&e?n.static?e:e.prototype:null,d=t||(m?Object.getOwnPropertyDescriptor(m,n.name):{}),h=!1,u=r.length-1;u>=0;u--){var p={};for(var f in n)p[f]="access"===f?{}:n[f];for(var f in n.access)p.access[f]=n.access[f];p.addInitializer=function(e){if(h)throw TypeError("Cannot add initializers after decoration has completed");s.push(i(e||null))};var v=(0,r[u])("accessor"===c?{get:d.get,set:d.set}:d[l],p);if("accessor"===c){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw TypeError("Object expected");(o=i(v.get))&&(d.get=o),(o=i(v.set))&&(d.set=o),(o=i(v.init))&&a.unshift(o)}else(o=i(v))&&("field"===c?a.unshift(o):d[l]=o)}m&&Object.defineProperty(m,n.name,d),h=!0},F=function(e,t,r){for(var n=arguments.length>2,a=0;a<t.length;a++)r=n?t[a].call(e,r):t[a].call(e);return n?r:void 0};let Z=e=>e?`@${e}`:e,I=(e,t)=>t.username||t.name?!t.username&&t.name?`The boring ${t.name}`:t.username&&!t.name?`The sneaky @${t.username}`:`${t.name} the @${t.username}`:"The unknown",E=(s=w.FormSchema,i=[],o=[],c=[],h=class extends s{constructor(){super(),this.username=(F(this,i),F(this,o,"")),this.name="",this.title=F(this,c,""),(0,O.rC)(this,{username:O.LO.ref,name:O.LO.ref})}},(()=>{var e;let t="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(e=s[Symbol.metadata])&&void 0!==e?e:null):void 0;n=[(0,w.present)(Z)],a=[(0,w.present)(I)],T(null,null,n,{kind:"field",name:"username",static:!1,private:!1,access:{has:e=>"username"in e,get:e=>e.username,set:(e,t)=>{e.username=t}},metadata:t},o,i),T(null,null,a,{kind:"field",name:"title",static:!1,private:!1,access:{has:e=>"title"in e,get:e=>e.title,set:(e,t)=>{e.title=t}},metadata:t},c,i),t&&Object.defineProperty(h,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:t})})(),h),P=(0,S.Pi)(({data:e,title:t})=>(0,p.BX)("div",{style:{marginTop:12},children:[(0,p.tZ)("b",{children:t}),(0,p.tZ)("div",{style:{marginTop:4,whiteSpace:"pre"},children:JSON.stringify(e,void 0,2)})]})),B=(0,S.Pi)(()=>{let e=(0,k.useMemo)(()=>E.create(),[]);return(0,p.BX)("div",{children:[(0,p.tZ)(f.nv,{schema:e,field:"name",label:"Name"}),(0,p.tZ)(f.nv,{schema:e,field:"username",label:"Username"}),(0,p.tZ)(P,{title:"Real values",data:e}),(0,p.tZ)(P,{title:"Presentation",data:e.presentation})]})});var C=function(e,t,r,n,a,s){function i(e){if(void 0!==e&&"function"!=typeof e)throw TypeError("Function expected");return e}for(var o,c=n.kind,l="getter"===c?"get":"setter"===c?"set":"value",m=!t&&e?n.static?e:e.prototype:null,d=t||(m?Object.getOwnPropertyDescriptor(m,n.name):{}),h=!1,u=r.length-1;u>=0;u--){var p={};for(var f in n)p[f]="access"===f?{}:n[f];for(var f in n.access)p.access[f]=n.access[f];p.addInitializer=function(e){if(h)throw TypeError("Cannot add initializers after decoration has completed");s.push(i(e||null))};var v=(0,r[u])("accessor"===c?{get:d.get,set:d.set}:d[l],p);if("accessor"===c){if(void 0===v)continue;if(null===v||"object"!=typeof v)throw TypeError("Object expected");(o=i(v.get))&&(d.get=o),(o=i(v.set))&&(d.set=o),(o=i(v.init))&&a.unshift(o)}else(o=i(v))&&("field"===c?a.unshift(o):d[l]=o)}m&&Object.defineProperty(m,n.name,d),h=!0},j=function(e,t,r){for(var n=arguments.length>2,a=0;a<t.length;a++)r=n?t[a].call(e,r):t[a].call(e);return n?r:void 0};let z=(l=w.FormSchema,m=[],d=[],u=class extends l{constructor(){super(),this.username=(j(this,m),j(this,d,"")),this.name="",(0,O.rC)(this,{username:O.LO.ref,name:O.LO.ref})}},(()=>{var e;let t="function"==typeof Symbol&&Symbol.metadata?Object.create(null!==(e=l[Symbol.metadata])&&void 0!==e?e:null):void 0;C(null,null,[(e=w.present).hidden.bind(e)],{kind:"field",name:"username",static:!1,private:!1,access:{has:e=>"username"in e,get:e=>e.username,set:(e,t)=>{e.username=t}},metadata:t},d,m),t&&Object.defineProperty(u,Symbol.metadata,{enumerable:!0,configurable:!0,writable:!0,value:t})})(),u),X=(0,S.Pi)(({data:e,title:t})=>(0,p.BX)("div",{style:{marginTop:12},children:[(0,p.tZ)("b",{children:t}),(0,p.tZ)("div",{style:{marginTop:4,whiteSpace:"pre"},children:JSON.stringify(e,void 0,2)})]})),$=(0,S.Pi)(()=>{let e=(0,k.useMemo)(()=>z.create(),[]);return(0,p.BX)("div",{children:[(0,p.tZ)(f.nv,{schema:e,field:"name",label:"Name"}),(0,p.tZ)(f.nv,{schema:e,field:"username",label:"Username"}),(0,p.tZ)(X,{title:"Real values",data:e}),(0,p.tZ)(X,{title:"Presentation",data:e.presentation})]})}),L=()=>(0,p.BX)(p.HY,{children:[(0,p.BX)(f.$0,{title:"Form data post-process: Presentation",children:[(0,p.tZ)(f.xv,{children:"The last thing left to be learned is the form data presentation. You can process the data in a form schema before sending it to the backend."}),(0,p.BX)(f.xv,{children:["If you want to change the presentation of a specific property, you have to use the ",(0,p.tZ)(f.EK,{children:"@present"})," decorator. Then, you have to use the ",(0,p.tZ)(f.EK,{children:"presentation"})," getter from the form schema in order to get post-processed data."]}),(0,p.BX)(f.xv,{children:["In the example below 2 values are post-processed: the ",(0,p.tZ)("i",{children:'"name"'})," and ",(0,p.tZ)("i",{children:'"title"'}),". You try entering and deleting data in fields to see how the presentation changes."]}),(0,p.tZ)(f.KE,{items:[v,b],children:(0,p.tZ)(B,{})}),(0,p.BX)(f.$0,{title:"Deleting data from presentation",children:[(0,p.BX)(f.xv,{children:["You can also delete some properties from the presentation. For example, in the article "," ",(0,p.tZ)(f.rU,{to:"/learn/observation/modifiers",className:x.Z.link,children:'"Form observation with non-primitive values"'}),", there is an example of using an array of nested schemas. And we created an extra ",(0,p.tZ)(f.EK,{children:"id"})," property in order to simplify the use of React. This property is only needed for React, and should not be sent to the backend. And if you have such properties, you can easily cut them of the presentation."]}),(0,p.BX)(f.xv,{children:["To do it, you can use the ",(0,p.tZ)(f.EK,{children:"@present.hidden"})," decorator."]}),(0,p.tZ)(f.KE,{items:[y,g],children:(0,p.tZ)($,{})})]})]}),(0,p.tZ)(f.$0,{title:"Next",forcedLevel:3,children:"You'll see a complete example of using MobX Form Schema."})]});var A=L},4593:function(e,t,r){r.d(t,{FormSchema:function(){return A},factory:function(){return q},nestedSchema:function(){return ei},nestedSchemasArray:function(){return eo},present:function(){return er},validate:function(){return E},watch:function(){return W}});var n,a,s,i=r(75);let o=e=>Symbol(e),c=o(),l=o(),m=o("InitialValues"),d=o("Errors"),h=o("ChangedKeys"),u=o(),p=o(),f=o(),v=o(),b=Object,y="comparator",g="presentation",x="schema",S="schemasArray",k=b.keys,w=new WeakMap,O=(e,t="string")=>typeof e===t,T=e=>w.get(e),F=(e,t,r)=>(r=(r=T(t))&&r[e])?r:(r=O(r=b.getPrototypeOf(t),"object")?r:null)?F(e,r):void 0,Z=(e,t)=>F(e,t)||{},I=(e,t,r,n,a,s)=>{t&&(O(r)||O(r,"symbol"))?((a=Z(e,t))[f]!==t&&(a=b.assign({},a)),a[r]=n,a[f]=t,(T(t)||w.set(t,{})&&T(t))[e]=a):r.addInitializer(function(){I(e,this,r.name,n)})},E=(...e)=>(t,r)=>I(l,t,r,{validators:e});E.if=(e,t)=>(r,n)=>I(l,r,n,{validators:t,condition:e});let P=(e,t,r)=>J(k(e).concat(k(t))).forEach(e=>r(e)),B=(e,t,r)=>!!(t[r]&&(!t[r].condition||t[r].condition(e[r],e))),C=(e,t,r,n=B(e,t,r),a)=>!!t[r]&&(n&&t[r].validators.find(t=>a=t(e[r],e)),(0,i.z)(()=>O(a)||!0===a?e[d][r]=a:delete e[d][r]),a),j=(e,t,r,n)=>(n=!t[r]||t[r][y](e[r],e[m][r],e,r),(0,i.z)(()=>e[h][n?"delete":"add"](r)),!n),z=(e,t,r,n)=>k(n=Z(t,e)).reduce((t,a)=>!!r(e,n,a)||t,!1),X=(e,t,r,n)=>k(n=Z(c,e)).forEach(a=>r(e,a,n[a][t])),$=e=>{e[v]&&(e.updateIsValidAll(),e.updateIsChangedAny())},L=(e,t)=>k(e).forEach(e=>t(e));class A{static create(e={},t){let r=new this(e),n=Z(u,r),a=Z(l,r),s=Z(c,r),o={[m]:i.LO.ref,[h]:i.LO,[d]:i.LO,[g]:i.Fl,isChanged:i.Fl,isValid:i.Fl,errors:i.Fl,updateIsPropertyChanged:i.aD,updateIsPropertyValid:i.aD,updateIsChangedAny:i.aD,updateIsValidAll:i.aD,reset:i.aD,sync:i.aD};P(n,e,t=>{n[t]?r[t]=n[t](e[t],e,r,r[t]):t in e&&(r[t]=e[t])}),L(s,(e,t,n)=>{(0,i.wn)(r,e)||(t=i.LO,(n=s[e][y])===_||n===V?t=i.LO.ref:(n===R||n===U||n===K)&&(t=i.LO.shallow),o[e]=t)});try{(0,i.rC)(r,o)}catch(e){L(o,e=>!(0,i.wn)(r,e)&&o[e](r,e)),(0,i.rC)(r)}return r.sync(),r[v]=t,t||(L(s,(e,t)=>(0,i.N7)(r,e,()=>(t&&t(),t=(0,i.EH)(()=>j(r,s,e))),!0)),L(a,(e,t)=>{t=i.LO.box(!1),(0,i.EH)(n=>(n=B(r,a,e),(0,i.z)(()=>t.set(n)))),(0,i.EH)(()=>C(r,a,e,t.get()))})),r.onInit&&r.onInit(),r}get presentation(){let e={},t=this,r=Z(p,t);return P(r,t,(n,a)=>{(a=r[n])&&a.hidden||(e[n]=a&&a[g]?a[g](t[n],t):t[n])}),e}get isChanged(){return this[h].size>0}get isValid(){return b.values(this[d]).every(e=>!e)}get errors(){return this[d]}get changedProperties(){return this[h]}getInitial(e){return this[m][e]}sync(){let e={};X(this,"saveFn",(t,r,n)=>e[r]=n(t[r],t)),this[m]=e,$(this)}reset(){X(this,"restoreFn",(e,t,r)=>e[t]=r(e[m][t],e)),$(this)}updateIsPropertyValid(e){return C(this,Z(l,this),e)}updateIsValidAll(){return z(this,l,C)}updateIsPropertyChanged(e){return j(this,Z(c,this),e)}updateIsChangedAny(){return z(this,c,j)}constructor(){this[n]={},this[a]=J(),this[s]={}}}n=d,a=h,s=m;let H=e=>(e&&e.sync(),e),N=e=>(e&&e.reset(),e),_=(e,t,r,n,a,s)=>(!e||!e.isChanged)&&(e===t||!!e&&!!t&&e.constructor===t.constructor&&((s=k(a=Z(c,e)).find(r=>!a[r][y](e[r],t[r],e)))&&(0,i.z)(()=>e[m]=t[m]),!s)),D=e=>(t,r,n,a)=>!!(r&&t?r.length===t.length&&t.every((t,s)=>e(t,r[s],n,a)):r===t),V=(e,t)=>e===t,M=e=>e,K=D(_),U=(e,t,r,n)=>!!(e&&t&&e.size===t.size&&Array.from(e).every(e=>t.has(e))),R=D(V),Y=e=>e.slice(),J=e=>new Set(e),Q=(e,t,r)=>{let n=(n,a)=>I(c,n,a,{[y]:e,saveFn:t,restoreFn:r});return n[y]=e,n},W=Q(V,M,M);W.create=Q,W[x]=Q(_,H,N),W[S]=Q(K,e=>e?e.map(H):e,e=>e?e.map(N):e),W.array=Q(R,Y,Y),W.set=Q(U,J,J);let q=e=>(t,r)=>I(u,t,r,e),G=(e,t)=>t?e.create(t):t,ee=e=>(t,r)=>q((n,a,s,i)=>(t&&O(r)?r:r.name)in a?e(n,a,s,i):i)(t,r);q[x]=e=>ee(t=>G(e,t)),q[S]=e=>ee(t=>t?t.map(t=>G(e,t)):t),q.set=ee(J);let et=e=>(t,r)=>I(p,t,r,e),er=e=>et({[g]:e});er.hidden=et({hidden:!0});let en=(e,t,r,n,a,s)=>(E(r)(e,t),n(e,t),a(e,t),er(s)(e,t)),ea=e=>!e.isValid,es=e=>e[g],ei=e=>(t,r)=>en(t,r,ea,W[x],q[x](e),es),eo=e=>(t,r)=>en(t,r,e=>e.some(ea),W[S],q[S](e),e=>e.map(es))},8520:function(e,t,r){e.exports=r(4593)}}]);